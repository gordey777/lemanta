{* <!-- ===========================================================================
                                                                                  |
    Модуль: Канонизатор страниц.                                                  |
    ----------------------------------------------------------------------------  |
                                                                                  |
    Входные переменные:                                                           |
        $noCanonical = TRUE если пропустить тег канонизации (по умолчанию FALSE)  |
            $unCivil = TRUE если режим канонизации "сам на себя" (по умолч.FALSE) |
                $unCivilAny = TRUE если "сам на себя" для всех (по умолчан.FALSE) |
            $noIndex = TRUE если принудительно закрыть от индекса (по умолч.FALSE)|
        $noPagination = TRUE если пропустить тег пагинации (по умолчанию FALSE)   |
            $noPrefetch = TRUE если опустить тег предзагрузки (по умолчанию FALSE)|
        $noSyndication = TRUE если пропустить тег синдикации (по умолчанию FALSE) |
                                                                                  |
    ----------------------------------------------------------------------------  |
    Обратите внимание, что тег синдикации может конфликтовать с тегами микро      |
    разметки RDFa.                                                                |
                                                                                  |
============================================================================ --> *}{strip}

    {* <!-- =======================================================================
    |                                                                             |
    |  Метатег Canonical (каноническая страница).                                 |
    |                                                                             |
    ======================================================================== --> *}

    {if empty($noCanonical)}
        {requestUri except='*' nopages=TRUE assign=uri}
        {requestUri except='*' nopages=FALSE assign=uri2}

        {$test = $smarty.server.REQUEST_URI|default:''}
        {$differ = $uri != $test && !empty($test)}
        {if $differ || !empty($unCivil)}

            {if empty($unCivil)}
                {$uri = preg_replace('!^[/\\\\]+!', '', $uri)}
                <link rel="canonical" href="{site root=TRUE}{$uri}" />

            {elseif !empty($unCivilAny) || $differ || $uri != $uri2}
                {$uri2 = preg_replace('!^[/\\\\]+!', '', $uri2)}
                <link rel="canonical" href="{site root=TRUE}{$uri2}" />
            {/if}

            {* <!-- ===============================================================
            |                                                                     |
            |  Метатег Noindex (принудительное закрытие от индексации).           |
            |                                                                     |
            ================================================================ --> *}

            {if $differ && !empty($noIndex)}
                <meta name="Robots" content="noindex, follow" />
            {/if}
        {/if}
    {/if}

    {* <!-- =======================================================================
    |                                                                             |
    |  Метатег Prev (предыдующая страница).                                       |
    |                                                                             |
    ======================================================================== --> *}

    {if empty($noPagination)}
        {if !empty($PrevPageUrl)}
            {$uri = preg_replace('!^([^?#]*).*?$!', '$1', $PrevPageUrl)}
            {$uri = preg_replace('!^[/\\\\]+!', '', $uri)}

            <link rel="prev" href="{site root=TRUE}{$uri|escape}" />
        {/if}

        {* <!-- ===================================================================
        |                                                                         |
        |  Метатег Next (следующая страница).                                     |
        |                                                                         |
        ==================================================================== --> *}

        {if !empty($NextPageUrl)}
            {$uri = preg_replace('!^([^?#]*).*?$!', '$1', $NextPageUrl)}
            {$uri = preg_replace('!^[/\\\\]+!', '', $uri)}

            <link rel="next" href="{site root=TRUE}{$uri|escape}" />
        {/if}
    {/if}

    {* <!-- =======================================================================
    |                                                                             |
    |  Метатег Prefetch (предзагрузка - в данном случае следующей страницы).      |
    |                                                                             |
    ======================================================================== --> *}

    {if empty($noPrefetch)}
        {if !empty($NextPageUrl)}
            {$uri = preg_replace('!^([^?#]*).*?$!', '$1', $NextPageUrl)}
            {$uri = preg_replace('!^[/\\\\]+!', '', $uri)}

            <link rel="prefetch" href="{site root=TRUE}{$uri|escape}" />
        {/if}
    {/if}

    {* <!-- =======================================================================
    |                                                                             |
    |  Метатег синдикации ленты новостей.                                         |
    |                                                                             |
    ======================================================================== --> *}

    {if empty($noSyndication)}
        <link rel="alternate" type="application/rss+xml" href="{site}rss" />
    {/if}

{/strip}