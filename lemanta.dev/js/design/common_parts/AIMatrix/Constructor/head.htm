{* <!-- ===========================================================================
  Система: Impera CMS                                                             |
  Сайт системы: http://imperacms.ru/                                              |
                                                                                  |
                                                                                  |
                                                                                  |
  Библиотека: Impera CMS Template Constructor                                     |
  Модуль: Document Head - заголовки страницы                                      |
  Версия модуля: 1.3                                                              |
  Автор: Разработчик Impera CMS                                                   |
                                                                                  |
                                                                                  |
                                                                                  |
  Назначение модуля: сформировать полную структуру тега head (заголовки страницы) |
  с учетом особенностей системы.                                                  |
                                                                                  |
                                                                                  |
                                                                                  |
  Принимает во входных переменных:                                                |
    $favicon = url (относительно папки шаблона) ярлыковой пиктограммы             |
    $more_metas = массив дополнительных мета тегов                                |
    $main_links = массив url-ей (относительно папки шаблона) основных подключений |
    $link_jquery = булевой признак "подключить jQuery"                            |
    $link_jqueryUI = булевой признак "подключить jQuery User Interface"           |
    $link_jqueryForm = булевой признак "подключить jQuery Ajax Form"              |
    $link_baloon = булевой признак "подключить валидатор форм"                    |
    $link_article_css = булевой признак "подключить стили карточки статьи/новости"|
    $link_callme_css = булевой признак "подключить стили Позвоните мне"           |
    $link_notify_css = булевой признак "подключить стили Уведомите меня"          |
    $link_fulminant_css = булевой признак "подключить стили мгновенного заказа"   |
    $link_credit_css = булевой признак "подключить стили кредитных программ"      |
    $link_cart_css = булевой признак "подключить стили корзины"                   |
    $link_slider = булевой признак "подключить слайдер изображений"               |
    $link_navigator = булевой признак "подключить навигатор с клавиатуры"         |
    $more_links = массив url-ей (относительно папки шаблона) дополнит.подключений |
    $noindex_pagination = булевой признак "не индексировать страницы 2,3,4,..."   |
    $noindex_urls = массив неиндексируемых url-ей (относительно корня магазина)   |
    $noindex_modules = массив имен неиндексируемых модулей                        |
    $enable_bgsound = булевой признак "разрешить фоновые звуки страницы"          |
                      (по умолчанию false)                                        |
    $auto_keywords = булевой признак "отсутствуют ключевые слова - берем из тегов"|
                      (по умолчанию true)                                         |
    $auto_canonical = булевой признак "авто канонизация URL-ов с GET-параметрами" |
                      (по умолчанию true)                                         |
    $autocomplete = параметры модуля автозавершителя поиска                       |
                                                                                  |
                                                                                  |
                                                                                  |
  Использует другие переменные:                                                   |
    $title = текст заголовка окна страницы                                        |
    $titleadd = добавочный текст к заголовку окна страницы                        |
    $description = текст для мета тега описания страницы                          |
    $keywords = текст для мета тега ключевых слов страницы                        |
    $error = текст сообщения об ошибке, если была                                 |
    $bgsound = url фонового звука страницы, если задан                            |
    $theme = полный url папки текущего шаблона клиентской стороны сайта           |
    $site = полный url корня сайта (то есть http://домен.сайта/ например)         |
    $smarty.get = массив GET-параметров запроса страницы                          |
    $smarty.const = массив констант движка                                        |
                                                                                  |
                                                                                  |
                                                                                  |
  Требует наличия в ПАПКЕ ШАБЛОНОВ следующих файлов:                              |
    common/admin.tools.css                                                        |
    common/article.css                                                            |
    common/callme.css                                                             |
    common/notify.css                                                             |
    common/fulminant-order.css                                                    |
    common/credit-programs.css                                                    |
    common/cart.css                                                               |
    common/slider.css                                                             |
    common_parts/Autocomplete-search/main.tpl                                     |
                                                                                  |
                                                                                  |
                                                                                  |
  Требует наличия в папке ОБЩИХ СКРИПТОВ САЙТА следующих файлов:                  |
    jquery/jquery.min.js                                                          |
    jquery-ui/css/ui-lightness/jquery-ui.css                                      |
    jquery-ui/jquery-ui.min.js                                                    |
    jquery-form/jquery.form.js                                                    |
    baloon/css/baloon.css                                                         |
    baloon/js/default.js                                                          |
    baloon/js/validate.js                                                         |
    baloon/js/baloon.js                                                           |
    ctrlnavigate.js                                                               |
    jquery.tools.min.js                                                           |
                                                                                  |
                                                                                  |
                                                                                  |
  Подключение из своего шаблона:                                                  |
    {include file = '../../common_parts/AIMatrix/Constructor/head.htm'            |
             favicon = строка                                                     |
             more_metas = массив строк                                            |
             main_links = массив строк                                            |
             link_jquery = true или false                                         |
             link_jqueryUI = true или false                                       |
             link_jqueryForm = true или false                                     |
             link_baloon = true или false                                         |
             link_article_css = true или false                                    |
             link_callme_css = true или false                                     |
             link_notify_css = true или false                                     |
             link_fulminant_css = true или false                                  |
             link_credit_css = true или false                                     |
             link_cart_css = true или false                                       |
             link_slider = true или false                                         |
             link_navigator = true или false                                      |
             more_links = массив строк                                            |
             noindex_pagination = true или false                                  |
             noindex_urls = массив строк                                          |
             noindex_modules = массив строк                                       |
             enable_bgsound = true или false                                      |
             auto_keywords = true или false                                       |
             auto_canonical = true или false                                      |
             autocomplete = массив параметров}                                    |
                                                                                  |
============================================================================ --> *}{strip}



    {$site = ($site|default:'')|escape}
    {$theme = ($theme|default:'')|escape}



    <head>
        <base href="{$site}" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

        {* <!-- заголовок, добавочный текст из SEO-модуля --> *}
        <title>
            {($title|default:'')|escape}
            {($titleadd|default:'')|escape}
        </title>

        {* <!-- мета описание --> *}
        {$value = $description|default:''}
        {$value = preg_replace('/\s+/', ' ', $value)}
        {$value = trim($value)}
        {if $value != ''}
            <meta content="{$value|escape}" name="description" />
        {/if}



        {* <!-- мета ключевые слова --> *}
        {$value = $keywords|default:''}
        {$value = preg_replace('/(\s*,\s*)+/', ', ', $value)}
        {$value = trim($value, ', ')}
        {if $value == ''}
            {if !isset($auto_keywords) || $auto_keywords}
                {if isset($product) && !empty($product)}
                    {$value = $product->tags|default:''}
                {elseif isset($category) && !empty($category)}
                    {$value = $category->tags|default:''}
                {elseif isset($brand) && !empty($brand)}
                    {$value = $brand->tags|default:''}
                {elseif isset($article) && !empty($article)}
                    {$value = $article->tags|default:''}
                {elseif isset($news_item) && !empty($news_item)}
                    {$value = $news_item->tags|default:''}
                {elseif isset($stock) && !empty($stock)}
                    {$value = $stock->tags|default:''}
                {elseif isset($file) && !empty($file)}
                    {$value = $file->tags|default:''}
                {/if}
                {$value = preg_replace('/(\s*,\s*)+/', ', ', $value)}
                {$value = trim($value, ', ')}
            {/if}
        {/if}

        {* <!-- тег ключевых слов --> *}
        {if $value != ''}
            {$value = preg_replace('/\s+/', ' ', $value)}
            <meta content="{$value|escape}" name="keywords" />
        {/if}



        {* <!-- канонический URL, если указан в самой записи --> *}
        {if isset($product) && !empty($product)}
            {$value = ($product->canonical_url_path|default:'')|cat:($product->canonical_url|default:'')}
        {elseif isset($category) && !empty($category)}
            {$value = ($category->canonical_url_path|default:'')|cat:($category->canonical_url|default:'')}
        {elseif isset($brand) && !empty($brand)}
            {$value = ($brand->canonical_url_path|default:'')|cat:($brand->canonical_url|default:'')}
        {elseif isset($article) && !empty($article)}
            {$value = ($article->canonical_url_path|default:'')|cat:($article->canonical_url|default:'')}
        {elseif isset($news_item) && !empty($news_item)}
            {$value = ($news_item->canonical_url_path|default:'')|cat:($news_item->canonical_url|default:'')}
        {elseif isset($stock) && !empty($stock)}
            {$value = ($stock->canonical_url_path|default:'')|cat:($stock->canonical_url|default:'')}
        {elseif isset($file) && !empty($file)}
            {$value = ($file->canonical_url_path|default:'')|cat:($file->canonical_url|default:'')}
        {else}
            {$value = ''}
        {/if}

        {* <!-- иначе авто канонический URL (если разрешен и URL содержит GET-параметры) --> *}
        {if preg_replace('/\s/', '', $value) == ''}
            {if !isset($auto_canonical) || $auto_canonical}
                {$value = $smarty.server.REQUEST_URI|default:''}
                {$value = (preg_replace('/[^?#]/', '', $value) == '') ? '' : preg_replace('/^([^?#]*).*?$/', '$1', $value)}
            {/if}
        {/if}

        {* <!-- тег канонизации --> *}
        {if preg_replace('/\s/', '', $value) != ''}
            {$value = $value|escape}
            {if preg_replace('!^[a-z]+://!i', '', $value) == $value}
                {$value = preg_replace('!^[/\\\\]+!', '', $value)}
                {$value = $site|cat:$value}
            {/if}
            <link rel="canonical" href="{$value}" />
        {/if}



        {* <!-- имя генератора страниц --> *}
        <meta content="Impera CMS {($smarty.const.IMPERA_CMS_CURRENT_VERSION|default:'')|escape}" name="generator" />



        {* <!-- если модуль в списке запрещенных к индексации --> *}
        {$value = ($smarty.request.module|default:'undefined_module')|lower}
        {if !isset($noindex_modules)}
            {$noindex_modules = [ 'Cart',
                                  'Captcha',
                                  'Import',
                                  'Order',
                                  'Compare',
                                  'FulminantOrder',
                                  'Login',
                                  'Registration',
                                  'Account',
                                  'Feedback',
                                  'CallMe',
                                  'NotifyMe' ]}
        {/if}
        {if is_array($noindex_modules) && !empty($noindex_modules)}
            {foreach $noindex_modules as $r}
                {if $r|lower == $value}
                    {$value = ''}
                    {break}
                {/if}
            {/foreach}
        {/if}
        {if $value == ''}
            <meta name="Robots" content="noindex,follow" />

        {* <!-- иначе если модуль в списке URL-ов, запрещенных к индексации --> *}
        {else}
            {$value = ($smarty.server.REQUEST_URI|default:'undefined_uri')|lower}
            {$value = preg_replace('/^([^?#]*).*?$/', '$1', $value)}
            {if !isset($noindex_urls)}
                {$noindex_urls = [ '/cart',
                                   '/defer',
                                   '/captcha',
                                   '/import',
                                   '/order',
                                   '/compare',
                                   '/vk_fail',
                                   '/vk_process',
                                   '/vk_success',
                                   '/fulminant-order',
                                   '/login',
                                   '/logout',
                                   '/registration',
                                   '/account',
                                   '/feedback',
                                   '/callme',
                                   '/notify',
                                   '/informer',
                                   '/admin' ]}
            {/if}
            {if is_array($noindex_urls) && !empty($noindex_urls)}
                {foreach $noindex_urls as $r}
                    {$r = $r|lower}
                    {$r2 = $r|cat:'/'}
                    {$s = strlen($r2)}
                    {if ($r == $value) || ($r2 == $value|truncate:$s:'':true)}
                        {$value = ''}
                        {break}
                    {/if}
                {/foreach}
            {/if}
            {if $value == ''}
                <meta name="Robots" content="noindex,follow" />

            {* <!-- иначе в многостраничных разрешаем индексировать лишь первую страницу, если просили --> *}
            {elseif !$noindex_pagination|default:false || $smarty.get.page|default:1 == 1}
                <meta name="Robots" content="index,follow" />

            {else}
                <meta name="Robots" content="noindex,follow" />
            {/if}
        {/if}



        {* <!-- дополнительные мета теги --> *}
        {if isset($more_metas) && is_array($more_metas) && !empty($more_metas)}
            {foreach $more_metas as $r}
                {$r}
            {/foreach}
        {/if}



        {* <!-- ярлыковая пиктограмма (favicon) --> *}
        {$favicon = ($favicon|default:'images/favicon.ico')|escape}
        <link href="{$theme}{$favicon}" rel="icon" type="image/vnd.microsoft.icon" />
        <link href="{$theme}{$favicon}" rel="shortcut icon" type="image/x-icon" />



        {* <!-- подключение основных стилей и скриптов --> *}
        {if isset($main_links) && is_array($main_links) && !empty($main_links)}
            {foreach $main_links as $r}
                {if $r|truncate:4:'':true|lower == 'css/'}
                    <link href="{$theme}{$r|escape}" media="all" rel="stylesheet" type="text/css" />
                {elseif $r|truncate:3:'':true|lower == 'js/'}
                    <script src="{$theme}{$r|escape}" type="text/javascript"></script>
                {elseif preg_replace('/[^<>]/', '', $r) != ''}
                    {$r}
                {/if}
            {/foreach}
        {/if}



        {* <!-- если это админ, подключаем стили его инструментов --> *}
        {if $smarty.session.admin|default:'' == 'admin'}
            <link href="{$site}design/common/admin.tools.css" media="screen" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- библиотека jQuery --> *}
        {if isset($link_jquery) && $link_jquery}
            <script src="{$site}js/jquery/jquery.min.js" type="text/javascript"></script>
        {/if}



        {* <!-- библиотека jQuery UI (user interface) --> *}
        {if isset($link_jqueryUI) && $link_jqueryUI}
            <link href="{$site}js/jquery-ui/css/ui-lightness/jquery-ui.css" rel="stylesheet" type="text/css" />
            <script src="{$site}js/jquery-ui/jquery-ui.min.js" type="text/javascript"></script>
        {/if}



        {* <!-- скрипт для слайдера изображений --> *}
        {if isset($link_slider) && $link_slider}
            <link href="{$site}design/common/slider.css" rel="stylesheet" type="text/css" />
            <script src="{$site}js/jquery.tools.min.js" type="text/javascript"></script>
        {/if}



        {* <!-- скрипт передачи форм ajax-запросом --> *}
        {if isset($link_jqueryForm) && $link_jqueryForm}
            <script src="{$site}js/jquery-form/jquery.form.js" type="text/javascript"></script>
        {/if}



        {* <!-- скрипт проверки ввода обязательных полей форм --> *}
        {if isset($link_baloon) && $link_baloon}
            <link href="{$site}js/baloon/css/baloon.css" media="screen" rel="stylesheet" type="text/css" />
            <script src="{$site}js/baloon/js/default.js" type="text/javascript"></script>
            <script src="{$site}js/baloon/js/validate.js" type="text/javascript"></script>
            <script src="{$site}js/baloon/js/baloon.js" type="text/javascript"></script>
        {/if}



        {* <!-- стили карточки статьи / новости --> *}
        {if isset($link_article_css) && $link_article_css}
            <link href="{$site}design/common/article.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- стили запроса связи (функция "Позвоните мне") --> *}
        {if isset($link_callme_css) && $link_callme_css}
            <link href="{$site}design/common/callme.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- стили подключения к уведомлению --> *}
        {if isset($link_notify_css) && $link_notify_css}
            <link href="{$site}design/common/notify.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- стили мгновенного заказа --> *}
        {if isset($link_fulminant_css) && $link_fulminant_css}
            <link href="{$site}design/common/fulminant-order.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- стили кредитных программ --> *}
        {if isset($link_credit_css) && $link_credit_css}
            <link href="{$site}design/common/credit-programs.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- стили корзины --> *}
        {if isset($link_cart_css) && $link_cart_css}
            <link href="{$site}design/common/cart.css" rel="stylesheet" type="text/css" />
        {/if}



        {* <!-- скрипт навигации по страницам с клавиатуры --> *}
        {if isset($link_navigator) && $link_navigator}
            <script src="{$site}js/ctrlnavigate.js" type="text/javascript"></script>
        {/if}



        {* <!-- подключаем автозавершитель поиска --> *}
        {if $autocomplete['input_id']|default:'' != ''}
            {include file = '../../../common_parts/Autocomplete-search/main.tpl'
    
                     input_id = $autocomplete['input_id']

                     width = ((isset($autocomplete['width'])) ? $autocomplete['width'] : 500)
                     height = ((isset($autocomplete['height'])) ? $autocomplete['height'] : 600)

                     product_maxcount = ((isset($autocomplete['product_maxcount'])) ? $autocomplete['product_maxcount'] : 10)
                         product_show_metatitle = ((isset($autocomplete['product_show_metatitle'])) ? $autocomplete['product_show_metatitle'] : false)
                         product_show_image = ((isset($autocomplete['product_show_image'])) ? $autocomplete['product_show_image'] : true)
                         product_show_price = ((isset($autocomplete['product_show_price'])) ? $autocomplete['product_show_price'] : true)
                         product_show_pcode = ((isset($autocomplete['product_show_pcode'])) ? $autocomplete['product_show_pcode'] : true)
                         product_show_sku = ((isset($autocomplete['product_show_sku'])) ? $autocomplete['product_show_sku'] : true)
                             product_by_model = ((isset($autocomplete['product_by_model'])) ? $autocomplete['product_by_model'] : true)
                             product_by_metatitle = ((isset($autocomplete['product_by_metatitle'])) ? $autocomplete['product_by_metatitle'] : false)
                             product_by_metakeywords = ((isset($autocomplete['product_by_metakeywords'])) ? $autocomplete['product_by_metakeywords'] : false)
                             product_by_body = ((isset($autocomplete['product_by_body'])) ? $autocomplete['product_by_body'] : false)
                             product_by_tags = ((isset($autocomplete['product_by_tags'])) ? $autocomplete['product_by_tags'] : false)
                             product_by_barcode = ((isset($autocomplete['product_by_barcode'])) ? $autocomplete['product_by_barcode'] : false)
                             product_by_pcode = ((isset($autocomplete['product_by_pcode'])) ? $autocomplete['product_by_pcode'] : true)
                             product_by_sku = ((isset($autocomplete['product_by_sku'])) ? $autocomplete['product_by_sku'] : true)

                     category_maxcount = ((isset($autocomplete['category_maxcount'])) ? $autocomplete['category_maxcount'] : 4)
                         category_show_metatitle = ((isset($autocomplete['category_show_metatitle'])) ? $autocomplete['category_show_metatitle'] : false)
                         category_show_image = ((isset($autocomplete['category_show_image'])) ? $autocomplete['category_show_image'] : false)
                             category_by_name = ((isset($autocomplete['category_by_name'])) ? $autocomplete['category_by_name'] : true)
                             category_by_metatitle = ((isset($autocomplete['category_by_metatitle'])) ? $autocomplete['category_by_metatitle'] : false)
                             category_by_metakeywords = ((isset($autocomplete['category_by_metakeywords'])) ? $autocomplete['category_by_metakeywords'] : false)
                             category_by_body = ((isset($autocomplete['category_by_body'])) ? $autocomplete['category_by_body'] : false)
                             category_by_tags = ((isset($autocomplete['category_by_tags'])) ? $autocomplete['category_by_tags'] : false)

                     brand_maxcount = ((isset($autocomplete['brand_maxcount'])) ? $autocomplete['brand_maxcount'] : 4)
                         brand_show_metatitle = ((isset($autocomplete['brand_show_metatitle'])) ? $autocomplete['brand_show_metatitle'] : false)
                         brand_show_image = ((isset($autocomplete['brand_show_image'])) ? $autocomplete['brand_show_image'] : false)
                             brand_by_name = ((isset($autocomplete['brand_by_name'])) ? $autocomplete['brand_by_name'] : true)
                             brand_by_metatitle = ((isset($autocomplete['brand_by_metatitle'])) ? $autocomplete['brand_by_metatitle'] : false)
                             brand_by_metakeywords = ((isset($autocomplete['brand_by_metakeywords'])) ? $autocomplete['brand_by_metakeywords'] : false)
                             brand_by_body = ((isset($autocomplete['brand_by_body'])) ? $autocomplete['brand_by_body'] : false)
                             brand_by_tags = ((isset($autocomplete['brand_by_tags'])) ? $autocomplete['brand_by_tags'] : false)

                     link_css = ((isset($autocomplete['link_css'])) ? $autocomplete['link_css'] : true)
                     link_engine = ((isset($autocomplete['link_engine'])) ? $autocomplete['link_engine'] : true)}
        {/if}



        {* <!-- подключение дополнительных стилей и скриптов --> *}
        {if isset($more_links) && is_array($more_links) && !empty($more_links)}
            {foreach $more_links as $r}
                {if $r|truncate:4:'':true|lower == 'css/'}
                    <link href="{$theme}{$r|escape}" media="all" rel="stylesheet" type="text/css" />
                {elseif $r|truncate:3:'':true|lower == 'js/'}
                    <script src="{$theme}{$r|escape}" type="text/javascript"></script>
                {elseif preg_replace('/[^<>]/', '', $r) != ''}
                    {$r}
                {/if}
            {/foreach}
        {/if}



        {* <!-- если есть ошибка, задаем фоновый звук страницы --> *}
        {if $enable_bgsound|default:false}
            {if $error|default:'' != ''}
                <bgsound src="{$site}sounds/error.wav">

            {* <!-- иначе если указан конкретный фоновый звук --> *}
            {elseif $bgsound|default:'' != ''}
                <bgsound src="{$bgsound|escape}">
            {/if}
        {/if}

    </head>

{/strip}